variables:
  major: 1
  minor: 0
  longsha: $[replace(replace(replace(replace(replace(variables['Build.SourceVersion'],'0','0,'),'1','1,'),'2','2,'),'3','3,'),'4','4,')]
  longsha2: $[replace(replace(replace(replace(replace(variables.longsha,'5','5,'),'6','6,'),'7','7,'),'8','8,'),'9','9,')]
  longsha3: $[replace(replace(replace(replace(replace(replace(variables.longsha2,'a','a,'),'b','b,'),'c','c,'),'d','d,'),'e','e,'),'f','f,')]
  shortsha2: $[format('{0}{1}{2}{3}{4}{5}{6}{7}', 'P', split(variables.longsha3, ',')[0], split(variables.longsha3, ',')[1], split(variables.longsha3, ',')[2], split(variables.longsha3, ',')[3], split(variables.longsha3, ',')[4], split(variables.longsha3, ',')[5], split(variables.longsha3, ',')[6])]
  #shortsha: $[format('{0}{1}{2}{3}{4}{5}{6}', variables['Build.SourceVersion'][0], variables['Build.SourceVersion'][1], variables['Build.SourceVersion'][2], variables['Build.SourceVersion'][3], variables['Build.SourceVersion'][4], variables['Build.SourceVersion'][5], variables['Build.SourceVersion'][6])]
  ${{ if or(eq(variables['Build.SourceBranch'], 'refs/heads/main'), startsWith(variables['Build.SourceBranch'], 'refs/heads/release/')) }}:
    patch: $[counter(format('{0}.{1}', variables['major'], variables['minor']), 0)]
  ${{ if and(ne(variables['Build.SourceBranch'], 'refs/heads/main'), ne(startsWith(variables['Build.SourceBranch'], 'refs/heads/release/'), 'True')) }}:
    patch: 0
  version.assembly: $[format('{0}.{1}.{2}', variables['major'], variables['minor'], variables['patch'])]
  version.file: $[format('{0}.{1}', variables['version.assembly'], variables['Build.BuildId'])]
  ${{ if or(eq(variables['Build.SourceBranch'], 'refs/heads/main'), startsWith(variables['Build.SourceBranch'], 'refs/heads/release/')) }}:
    version.informational: $[variables['version.file']]
  ${{ if and(ne(variables['Build.SourceBranch'], 'refs/heads/main'), ne(startsWith(variables['Build.SourceBranch'], 'refs/heads/release/'), 'True')) }}:
    version.informational: $[format('{0}-{1}', variables['version.assembly'], variables['Build.SourceVersion'])]
  build.number: $[variables['version.informational']]